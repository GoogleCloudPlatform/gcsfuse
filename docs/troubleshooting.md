# Troubleshooting for production issues
This page enumerates some common user facing issues around GCSFuse and also
discusses potential solutions to the same.

| Issues                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Fix                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Generic Mounting Issue                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Most of the common mount point issues are around permissions on both local mount point and the Cloud Storage bucket. It is highly recommended to retry with --foreground --debug_fuse --debug_fs --debug_gcs --debug_http flags which would provide much more detailed logs to understand the errors better and possibly provide a solution.                                                                                                                                                                                                                                                                           |
| Mount successful but files not visible                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Try mounting the gcsfuse with --implicit-dir flag. Read the [semantics](https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/semantics.md) to know the reasoning.                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Mount failed with fusermount3 exit status 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | It comes when the bucket is already mounted in a folder and we try to mount it again. You need to unmount first and then remount.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| version `GLIBC_x.yz` not found                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | GCSFuse should not be linking to glibc. Please either `export CGO_ENABLED=0` in your environment or prefix `CGO_ENABLED=0` to any <code>go build&#124;run&#124;test</code> commands that you're invoking.                                                                                                                                                                                                                                                                                                                                                                                                              |
| Mount get stuck with error: DefaultTokenSource: google: could not find default credentials                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Run ```gcloud auth application-default login``` command to fetch default credentials to the VM. This will fetch the credentials to the following locations: <ol type="a"><li>For linux - $HOME/.config/gcloud/application_default_credentials.json</li><li>For windows - %APPDATA%/gcloud/applicateion_default_credentials.json </li></ol>                                                                                                                                                                                                                                                                             |
| Input/Output Error                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Itâ€™s a generic error, but the most probable culprit is the bucket not having the right permission for Cloud Storage FUSE to operate on. Ref - [here](https://stackoverflow.com/questions/36382704/gcsfuse-input-output-error)                                                                                                                                                                                                                                                                                                                                                                                          |
| Generic NO_PUBKEY Error - while installing Cloud Storage FUSE on ubuntu 22.04                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | It happens while running - ```sudo apt-get update``` - working on installing Cloud Storage FUSE. You just have to add the pubkey you get in the error using the below command: ```sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys <PUBKEY> ``` And then try running ```sudo apt-get update```                                                                                                                                                                                                                                                                                                            |
| Cloud Storage FUSE fails with Docker container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Though not tested extensively, the [community](https://stackoverflow.com/questions/65715624/permission-denied-with-gcsfuse-in-unprivileged-ubuntu-based-docker-container) reports that Cloud Storage FUSE works only in privileged mode when used with Docker. There are [solutions](https://cloud.google.com/iam/docs/service-account-overview) which exist and claim to do so without privileged mode, but these are not tested by the Cloud Storage FUSE team                                                                                                                                                       |
| daemonize.Run: readFromProcess: sub-process: mountWithArgs: mountWithStorageHandle: fs.NewServer: create file system: SetUpBucket: OpenBucket: Bad credentials for bucket BUCKET_NAME: permission denied                                                                                                                                                                                                                                                                                                                                                                                                              | Check the bucket name. Make sure it is within your project. Make sure the applied roles on the bucket  contain storage.objects.list permission. You can refer to them [here](https://cloud.google.com/storage/docs/access-control/iam-roles).                                                                                                                                                                                                                                                                                                                                                                          |
| daemonize.Run: readFromProcess: sub-process: mountWithArgs: mountWithStorageHandle: fs.NewServer: create file system: SetUpBucket: OpenBucket: Unknown bucket BUCKET_NAME: no such file or directory                                                                                                                                                                                                                                                                                                                                                                                                                  | Check the bucket name. Make sure the [service account](https://www.google.com/url?q=https://cloud.google.com/iam/docs/service-accounts&sa=D&source=docs&ust=1679992003850814&usg=AOvVaw3nJ6wNQK4FZdgm8gBTS82l) has permissions to access the files. It must at least have the permissions of the Storage Object Viewer role.                                                                                                                                                                                                                                                                                           |
| daemonize.Run: readFromProcess: sub-process: mountWithArgs: mountWithStorageHandle: Mount: mount: running fusermount: exit status 1 stderr: /bin/fusermount: fuse device not found, try 'modprobe fuse' first                                                                                                                                                                                                                                                                                                                                                                                                         | To run the container locally, add the --privilege flag to the docker run command: ```docker run --privileged  gcr.io/PROJECT/my-fs-app ``` <ul><li>You must create a local mount directory</li> <li>If you want all the logs from the mount process use the --foreground flag in combination with the mount command: ```gcsfuse --foreground --debug_gcs --debug_fuse $GCSFUSE_BUCKET $MNT_DIR ``` </li><li> Add --debug_http for HTTP request/response debug output.</li><li>Add --debug_fuse to enable fuse-related debugging output.</li><li>Add --debug_gcs to print GCS request and timing information.</li></ul> |
| Cloud Storage FUSE installation fails with an error at build time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Only specific OS distributions are currently supported, learn more about [Installing Cloud Storage FUSE](https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/installing.md).                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Cloud Storage FUSE not mounting after reboot when entry is present in ```/etc/fstab``` with 1 or 2 as fsck order                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Pass [_netdev option](https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/mounting.md#persisting-a-mount) in fstab entry (reference issue [here](https://github.com/GoogleCloudPlatform/gcsfuse/issues/1043)). With this option, mount will be attempted on reboot only when network is connected.                                                                                                                                                                                                                                                                                                         |
| Cloud Storage FUSE get stuck when using it to concurrently work with a large number of opened files (reference issue [here](https://github.com/GoogleCloudPlatform/gcsfuse/issues/1043))                                                                                                                                                                                                                                                                                                                                                                                                                              | This happens when gcsfuse is mounted with http1 client (default) and the application using gcsfuse tries to keep more than value of `--max-conns-per-host` number of files opened. You can try (a) Passing a value higher than the number of files you want to keep open to `--max-conns-per-host` flag. (b) Adding some timeout for http client connections using `--http-client-timeout` flag.                                                                                                                                                                                                                       |
| permission denied error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Please refer [here](https://cloud.google.com/storage/docs/gcsfuse-mount#authenticate_by_using_a_service_account) to know more about permissions.(e.g.  **Issue**:mkdir: cannot create directory â€˜gcs/testâ€™: Permission denied. User can check specific errors by enabling logs with --debug_fuse and --debug_gcs flags. **Solution**: Provide roles/storage.objectAdmin role on the bucket.)  <br/>                                                                                                                                                                                                                    |
| Bad gateway error while installing/upgrading GCSFuse:<br/> `Err: http://packages.cloud.google.com/apt gcsfuse-focal/main amd64 gcsfuse amd64 1.2.0`<br/>`502  Bad Gateway [IP: xxx.xxx.xx.xxx 80]`                                                                                                                                                                                                                                                                                                                                                                                                                    | This error is seen when the url used in /etc/apt/sources.list.d/gcsfuse.list file uses HTTP protocol instead of HTTPS protocol. Run the following commands to update /etc/apt/sources.list.d/gcsfuse.list file with the https:// url.<br/> <code>$ sudo rm /etc/apt/sources.list.d/gcsfuse.list</code> <br/> <code>$ export GCSFUSE_REPO=gcsfuse-$(lsb_release -c -s)</code> <br/> <code>$ echo "deb https://packages.cloud.google.com/apt $GCSFUSE_REPO main" &#124; sudo tee /etc/apt/sources.list.d/gcsfuse.list </code>                                                                                            |
| Repository changed 'Origin' and 'Label' error while running `apt-get update` command:  <br/>`E: Repository 'http://packages.cloud.google.com/apt gcsfuse-focal InRelease' changed its 'Origin' value from 'gcsfuse-jessie' to 'namespaces/gcs-fuse-prod/repositories/gcsfuse-focal'`<br/>`E: Repository 'http://packages.cloud.google.com/apt gcsfuse-focal InRelease' changed its 'Label' value from 'gcsfuse-jessie' to 'namespaces/gcs-fuse-prod/repositories/gcsfuse-focal'`<br/>`N: This must be accepted explicitly before updates for this repository can be applied. See apt-secure(8) manpage for details. ` | Use one of the following commands to upgrade to latest GCSFuse version<br/> `sudo apt-get update --allow-releaseinfo-change `<br/>OR<br/>`sudo apt update -y && sudo apt-get update`                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Unable to unmount or stop GCSFuse due to an error message like:`fusermount: failed to unmount: Device or resource busy` or `umount: /path/to/mountpoint: target is busy`.</br>This typically indicates active processes are using files or directories within the GCSFuse mount.                                                                                                                                                                                                                                                                                                                                      | Find the process ID of GCSFuse:<br/>`BUCKET=<Enter your bucket name>`</br>` MOUNT_POINT=<Enter your mount point>`</br>`PID=$(ps -aux &#124; grep "gcsfuse.*$BUCKET.*$MOUNT_POINT" &#124; grep -v grep &#124; tr -s ' ' &#124; cut -d' ' -f2)`</br>Kill the GCSFuse process:</br>`sudo kill -SIGKILL "$PID"`</br>Unmount GCSFuse</br>`fusermount -u $"MOUNT_POINT"`                                                                                                                                                                                                                                                     |
