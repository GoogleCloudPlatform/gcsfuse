# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

explicit_dir:
  - mounted_directory: "${MOUNTED_DIR}" # To be passed by GKE after mounting
    test_bucket: "${BUCKET_NAME}" # To be passed by both gcsfuse and gke tests
    configs:
      - flags:
          - "--implicit-dirs=false"
          - "--implicit-dirs=false,--client-protocol=grpc"
        compatible: # Bucket type to run these tests with
          flat: true
          hns: false
          zonal: false
        run_on_gke: true

implicit_dir:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--implicit-dirs"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true
      - flags:
          - "--implicit-dirs,--client-protocol=grpc"
        compatible:
          flat: true
          hns: true
          zonal: false
        run_on_gke: true

list_large_dir:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--implicit-dirs,--stat-cache-ttl=0,--kernel-list-cache-ttl-secs=-1"
          - "--client-protocol=grpc,--implicit-dirs,--stat-cache-ttl=0,--kernel-list-cache-ttl-secs=-1"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true
        run: TestListLargeDirWithKernelListCache
      - flags:
          - "--enable-metadata-prefetch,--implicit-dirs"
          - "--client-protocol=grpc,--enable-metadata-prefetch,--implicit-dirs"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true
        run: TestListLargeDirWithoutKernelListCache
operations:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
        - "--metadata-cache-ttl-secs=0,--enable-streaming-writes=false"
        - "--kernel-list-cache-ttl-secs=-1,--implicit-dirs,--enable-metadata-prefetch"
        - "--experimental-enable-json-read,--enable-atomic-rename-object"
        - "--client-protocol=grpc,--implicit-dirs,--enable-atomic-rename-object,--enable-metadata-prefetch"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

write_large_files:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--enable-streaming-writes=false"
          # write-global-max-blocks=5 is for checking multiple file writes in parallel.
          # concurrent_write_files_test.go- we are writing 3 files in parallel.
          # with this config, we are giving 2 blocks to 2 files and 1 block to other file.
          - "--write-max-blocks-per-file=2,--write-global-max-blocks=5"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

gzip:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--sequential-read-size-mb=1,--implicit-dirs"
          - "--sequential-read-size-mb=1,--implicit-dirs,--client-protocol=grpc"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

read_large_files:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--implicit-dirs"
          - "--implicit-dirs,--client-protocol=grpc"
          - "--implicit-dirs,--file-cache-max-size-mb=700,--file-cache-cache-file-for-range-read,--cache-dir=${CACHE_DIR_PATH}"
          - "--implicit-dirs,--file-cache-max-size-mb=700,--file-cache-cache-file-for-range-read,--client-protocol=grpc,--cache-dir=${CACHE_DIR_PATH}"
          - "--implicit-dirs,--file-cache-max-size-mb=-1,--cache-dir=${CACHE_DIR_PATH}"
          - "--implicit-dirs,--file-cache-max-size-mb=-1,--client-protocol=grpc,--cache-dir=${CACHE_DIR_PATH}"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true
      - flags:
          - "--implicit-dirs --enable-kernel-reader=false"
        compatible:
          flat: false
          hns: false
          zonal: true
        run_on_gke: true

readonly:
  - mounted_directory: "${MOUNTED_DIR}" # To be passed by GKE after mounting
    test_bucket: "${BUCKET_NAME}" # To be passed by both gcsfuse and gke tests
    configs:
      - flags:
          - "--o=ro,--implicit-dirs"
          - "--file-mode=544,--dir-mode=544,--implicit-dirs"
          - "--client-protocol=grpc,--o=ro,--implicit-dirs"
          - "--o=ro,--implicit-dirs,--cache-dir=${CACHE_DIR_PATH},--file-cache-max-size-mb=3"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

rename_dir_limit:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    only_dir: "${ONLY_DIR}"
    configs:
      - flags:
          - "--rename-dir-limit=3,--implicit-dirs,--client-protocol=grpc"
          - "--rename-dir-limit=3"
          - "--rename-dir-limit=3,--client-protocol=grpc"
        compatible:
          flat: true
          hns: false
          zonal: false
        run_on_gke: true
      - flags:
          - ""
        compatible:
          flat: false
          hns: true
          zonal: true
        run_on_gke: true

local_file:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    only_dir: "${ONLY_DIR}"
    configs:
      - flags:
          - "--implicit-dirs,--rename-dir-limit=3,--enable-streaming-writes=false"
          - "--implicit-dirs=false,--rename-dir-limit=3,--enable-streaming-writes=false,--client-protocol=grpc"
          - "--rename-dir-limit=3,--write-block-size-mb=1,--write-max-blocks-per-file=2,--write-global-max-blocks=0"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true
      - flags:
          - "--rename-dir-limit=3,--write-block-size-mb=1,--write-max-blocks-per-file=2,--write-global-max-blocks=-1"
          - "--rename-dir-limit=3,--write-block-size-mb=1,--write-max-blocks-per-file=2,--write-global-max-blocks=-1,--client-protocol=grpc"
        compatible:
          flat: true
          hns: true
          zonal: false
        run_on_gke: true

streaming_writes:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--rename-dir-limit=3,--write-block-size-mb=1,--write-max-blocks-per-file=2,--client-protocol=grpc,--write-global-max-blocks=-1"
          - "--rename-dir-limit=3,--write-block-size-mb=1,--write-max-blocks-per-file=2,--write-global-max-blocks=-1"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

cloud_profiler:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          # Set the 'PROFILE_LABEL' environment variable for GKE
          - "--enable-cloud-profiler,--cloud-profiler-cpu,--cloud-profiler-heap,--cloud-profiler-goroutines,--cloud-profiler-mutex,--cloud-profiler-allocated-heap,--cloud-profiler-label=${PROFILE_LABEL}"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

requester_pays_bucket:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--billing-project=gcs-fuse-test-ml"
        compatible:
          flat: true
          hns: true
          zonal: false
        run_on_gke: true

read_cache:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    only_dir: "${ONLY_DIR}"
    configs:
      - flags:
          - "--metadata-cache-ttl-secs=10,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestSmallCacheTTLTest,--log-file=/gcsfuse-tmp/TestSmallCacheTTLTest.log,--log-severity=TRACE,--implicit-dirs,--enable-kernel-reader=false"
          - "--metadata-cache-ttl-secs=10,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestSmallCacheTTLTest,--log-file=/gcsfuse-tmp/TestSmallCacheTTLTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--metadata-cache-ttl-secs=10,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestSmallCacheTTLTest,--log-file=/gcsfuse-tmp/TestSmallCacheTTLTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--metadata-cache-ttl-secs=10,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestSmallCacheTTLTest,--log-file=/gcsfuse-tmp/TestSmallCacheTTLTest.log,--log-severity=TRACE,--client-protocol=grpc,--implicit-dirs,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestSmallCacheTTLTest
        run_on_gke: true
      - flags:
          - "--file-cache-max-size-mb=9,--file-cache-cache-file-for-range-read,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--file-cache-enable-parallel-downloads=false,--implicit-dirs,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-cache-file-for-range-read,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--file-cache-enable-parallel-downloads=false,--implicit-dirs,--o=ro,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--o=ro,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-cache-file-for-range-read,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--file-cache-enable-parallel-downloads=false,--implicit-dirs,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-cache-file-for-range-read,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--file-cache-enable-parallel-downloads=false,--implicit-dirs,--o=ro,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestReadOnlyTest,--log-file=/gcsfuse-tmp/TestReadOnlyTest.log,--log-severity=TRACE,--o=ro,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestReadOnlyTest
        run_on_gke: true
      - flags:
          - "--implicit-dirs,--file-cache-max-size-mb=15,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestRangeReadTest,--log-file=/gcsfuse-tmp/TestRangeReadTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--implicit-dirs,--file-cache-max-size-mb=15,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestRangeReadTest,--log-file=/gcsfuse-tmp/TestRangeReadTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestRangeReadTest
        run_on_gke: true
      - flags:
          - "--implicit-dirs,--file-cache-max-size-mb=15,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestRangeReadWithParallelDownloadsTest,--log-file=/gcsfuse-tmp/TestRangeReadWithParallelDownloadsTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--implicit-dirs,--file-cache-max-size-mb=15,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestRangeReadWithParallelDownloadsTest,--log-file=/gcsfuse-tmp/TestRangeReadWithParallelDownloadsTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestRangeReadWithParallelDownloadsTest
        run_on_gke: true
      - flags:
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestLocalModificationTest,--log-file=/gcsfuse-tmp/TestLocalModificationTest.log,--log-severity=TRACE,--implicit-dirs,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestLocalModificationTest,--log-file=/gcsfuse-tmp/TestLocalModificationTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestLocalModificationTest,--log-file=/gcsfuse-tmp/TestLocalModificationTest.log,--log-severity=TRACE,--implicit-dirs,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestLocalModificationTest,--log-file=/gcsfuse-tmp/TestLocalModificationTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestLocalModificationTest
        run_on_gke: true
      - flags:
          - "--stat-cache-ttl=0s,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestDisabledCacheTTLTest,--log-file=/gcsfuse-tmp/TestDisabledCacheTTLTest.log,--log-severity=TRACE,--implicit-dirs,--enable-kernel-reader=false"
          - "--stat-cache-ttl=0s,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestDisabledCacheTTLTest,--log-file=/gcsfuse-tmp/TestDisabledCacheTTLTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--stat-cache-ttl=0s,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestDisabledCacheTTLTest,--log-file=/gcsfuse-tmp/TestDisabledCacheTTLTest.log,--log-severity=TRACE,--implicit-dirs,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--stat-cache-ttl=0s,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestDisabledCacheTTLTest,--log-file=/gcsfuse-tmp/TestDisabledCacheTTLTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestDisabledCacheTTLTest
        run_on_gke: true
      - flags:
          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest.log,--log-severity=TRACE,--implicit-dirs,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest.log,--log-severity=TRACE,--file-cache-enable-o-direct,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest.log,--log-severity=TRACE,--implicit-dirs,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueTest.log,--log-severity=TRACE,--file-cache-enable-o-direct,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestCacheFileForRangeReadTrueTest
        run_on_gke: true
#        TODO: Enable Ram cache tests after bug b/383682524 is fixed
#      - flags:
#          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadTrueWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueWithRamCache.log,--log-severity=TRACE"
#          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadTrueWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueWithRamCache.log,--log-severity=TRACE,--file-cache-enable-o-direct"
#          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/dev/shm/TestCacheFileForRangeReadTrueWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueWithRamCache.log,--log-severity=TRACE"
#          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadTrueWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueWithRamCache.log,--log-severity=TRACE,--client-protocol=grpc"
#          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadTrueWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueWithRamCache.log,--log-severity=TRACE,--file-cache-enable-o-direct,--client-protocol=grpc"
#          - "--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/dev/shm/TestCacheFileForRangeReadTrueWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadTrueWithRamCache.log,--log-severity=TRACE,--client-protocol=grpc"
#        compatible:
#          flat: true
#          hns: true
#          zonal: true
#        run: TestCacheFileForRangeReadTrueWithRamCache
#        run_on_gke: true
      - flags:
          - "--implicit-dirs,--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadFalseTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--implicit-dirs,--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadFalseTest,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestCacheFileForRangeReadFalseTest
        run_on_gke: true
#      - flags:
#          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads=false,--cache-dir=/dev/shm/TestCacheFileForRangeReadFalseWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithRamCache.log,--log-severity=TRACE"
#          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads=false,--cache-dir=/dev/shm/TestCacheFileForRangeReadFalseWithRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithRamCache.log,--log-severity=TRACE,--client-protocol=grpc"
#        compatible:
#          flat: true
#          hns: true
#          zonal: true
#        run: TestCacheFileForRangeReadFalseWithRamCache
#        run_on_gke: true
      - flags:
          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads.log,--log-severity=TRACE,--file-cache-enable-o-direct,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloads.log,--log-severity=TRACE,--file-cache-enable-o-direct,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestCacheFileForRangeReadFalseWithParallelDownloads
        run_on_gke: true
#      - flags:
#          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache.log,--log-severity=TRACE"
#          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache.log,--log-severity=TRACE,--file-cache-enable-o-direct"
#          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache.log,--log-severity=TRACE,--client-protocol=grpc"
#          - "--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads,--cache-dir=/dev/shm/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache,--log-file=/gcsfuse-tmp/TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache.log,--log-severity=TRACE,--file-cache-enable-o-direct,--client-protocol=grpc"
#        compatible:
#          flat: true
#          hns: true
#          zonal: true
#        run: TestCacheFileForRangeReadFalseWithParallelDownloadsAndRamCache
#        run_on_gke: true
      - flags:
          - "--file-cache-max-size-mb=48,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestJobChunkTest,--log-file=/gcsfuse-tmp/TestJobChunkTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=48,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestJobChunkTest,--log-file=/gcsfuse-tmp/TestJobChunkTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestJobChunkTest
        run_on_gke: true
      - flags:
          # with unlimited max parallel downloads.
          - "--file-cache-max-size-mb=48,--file-cache-enable-parallel-downloads,--file-cache-parallel-downloads-per-file=4,--file-cache-max-parallel-downloads=-1,--file-cache-download-chunk-size-mb=4,--file-cache-enable-crc,--cache-dir=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads,--log-file=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=48,--file-cache-enable-parallel-downloads,--file-cache-parallel-downloads-per-file=4,--file-cache-max-parallel-downloads=-1,--file-cache-download-chunk-size-mb=4,--file-cache-enable-crc,--cache-dir=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads,--log-file=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          # with go-routines not limited by max parallel downloads.
          # maxParallelDownloads > parallelDownloadsPerFile * number of files being accessed concurrently.
          - "--file-cache-max-size-mb=48,--file-cache-enable-parallel-downloads,--file-cache-parallel-downloads-per-file=4,--file-cache-max-parallel-downloads=9,--file-cache-download-chunk-size-mb=4,--file-cache-enable-crc,--cache-dir=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads,--log-file=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=48,--file-cache-enable-parallel-downloads,--file-cache-parallel-downloads-per-file=4,--file-cache-max-parallel-downloads=9,--file-cache-download-chunk-size-mb=4,--file-cache-enable-crc,--cache-dir=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads,--log-file=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          # with go-routines limited by max parallel downloads.
          - "--file-cache-max-size-mb=48,--file-cache-enable-parallel-downloads,--file-cache-parallel-downloads-per-file=4,--file-cache-max-parallel-downloads=2,--file-cache-download-chunk-size-mb=4,--file-cache-enable-crc,--cache-dir=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads,--log-file=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=48,--file-cache-enable-parallel-downloads,--file-cache-parallel-downloads-per-file=4,--file-cache-max-parallel-downloads=2,--file-cache-download-chunk-size-mb=4,--file-cache-enable-crc,--cache-dir=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads,--log-file=/gcsfuse-tmp/TestJobChunkTestWithParallelDownloads.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestJobChunkTestWithParallelDownloads
        run_on_gke: true
      - flags:
          - "--file-cache-exclude-regex=.,--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-exclude-regex=.,--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-exclude-regex=^${BUCKET_NAME}/,--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-exclude-regex=.,--file-cache-max-size-mb=50,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-exclude-regex=.,--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-exclude-regex=^${BUCKET_NAME}/,--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          # Exclude regex flag takes precedence over include regex flag so files won't be cached.
          - "--file-cache-include-regex=^${BUCKET_NAME}/,--file-cache-exclude-regex=^${BUCKET_NAME}/,--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-include-regex=^${BUCKET_NAME}/,--file-cache-exclude-regex=^${BUCKET_NAME}/,--file-cache-max-size-mb=50,--file-cache-cache-file-for-range-read,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForExcludeRegexTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestCacheFileForExcludeRegexTest
        run_on_gke: true
      - flags:
          - "--implicit-dirs,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestRemountTest,--log-file=/gcsfuse-tmp/TestRemountTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--implicit-dirs,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestRemountTest,--log-file=/gcsfuse-tmp/TestRemountTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--implicit-dirs,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads=false,--cache-dir=/gcsfuse-tmp/TestRemountTest,--log-file=/gcsfuse-tmp/TestRemountTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--implicit-dirs,--file-cache-max-size-mb=9,--file-cache-enable-parallel-downloads,--cache-dir=/gcsfuse-tmp/TestRemountTest,--log-file=/gcsfuse-tmp/TestRemountTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestRemountTest
        run_on_gke: false
      - flags:
          - "--file-cache-include-regex=^${BUCKET_NAME}/.*ReadCacheTest/foo*,--file-cache-exclude-regex=,--file-cache-max-size-mb=9,--cache-dir=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-include-regex=^${BUCKET_NAME}/.*ReadCacheTest/foo*,--file-cache-exclude-regex=,--file-cache-max-size-mb=9,--cache-dir=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
          - "--file-cache-include-regex=^${BUCKET_NAME}/.*ReadCacheTest/foo*,--file-cache-exclude-regex=invalid,--file-cache-max-size-mb=9,--cache-dir=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest.log,--log-severity=TRACE,--enable-kernel-reader=false"
          - "--file-cache-include-regex=^${BUCKET_NAME}/.*ReadCacheTest/foo*,--file-cache-exclude-regex=invalid,--file-cache-max-size-mb=9,--cache-dir=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest,--log-file=/gcsfuse-tmp/TestCacheFileForIncludeRegexTest.log,--log-severity=TRACE,--client-protocol=grpc,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestCacheFileForIncludeRegexTest
        run_on_gke: true

stale_handle:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--metadata-cache-ttl-secs=0,--write-block-size-mb=1,--write-max-blocks-per-file=1"
          - "--metadata-cache-ttl-secs=0,--write-block-size-mb=1,--write-max-blocks-per-file=1,--client-protocol=grpc"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: "TestStaleHandleStreamingWritesEnabled"
        run_on_gke: true
      - flags:
          - "--metadata-cache-ttl-secs=0,--enable-streaming-writes=false"
          - "--metadata-cache-ttl-secs=0,--enable-streaming-writes=false,--client-protocol=grpc"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: "TestStaleHandleStreamingWritesDisabled"
        run_on_gke: true

readdirplus:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--implicit-dirs,--experimental-enable-readdirplus,--experimental-enable-dentry-cache,--log-file=/gcsfuse-tmp/TestReaddirplusWithDentryCacheTest.log,--log-severity=TRACE"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestReaddirplusWithDentryCacheTest
        run_on_gke: true
      - flags:
          - "--implicit-dirs,--experimental-enable-readdirplus,--log-file=/gcsfuse-tmp/TestReaddirplusWithoutDentryCacheTest.log,--log-severity=TRACE"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestReaddirplusWithoutDentryCacheTest
        run_on_gke: true

inactive_stream_timeout:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
        - "--read-inactive-stream-timeout=1s,--client-protocol=http1,--log-format=json,--log-file=/gcsfuse-tmp/TestTimeoutEnabledSuite.log"
        - "--read-inactive-stream-timeout=1s,--client-protocol=grpc,--log-format=json,--log-file=/gcsfuse-tmp/TestTimeoutEnabledSuite.log"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestTimeoutEnabledSuite
        run_on_gke: true
      - flags:
        - "--read-inactive-stream-timeout=0s,--client-protocol=http1,--log-format=json,--log-file=/gcsfuse-tmp/TestTimeoutDisabledSuite.log"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: TestTimeoutDisabledSuite
        run_on_gke: true


benchmarking:
  - test_bucket: "${BUCKET_NAME}"
    mounted_directory: "${MOUNTED_DIR}"
    configs:
      - flags:
          - "--stat-cache-ttl=0"
          - "--stat-cache-ttl=0 --client-protocol=grpc"
        compatible:
              flat: true
              hns: true
              zonal: true
        run: "Benchmark_Stat"
        run_on_gke: true
      - flags:
          - "--stat-cache-ttl=0,--enable-atomic-rename-object"
          - "--stat-cache-ttl=0,--enable-atomic-rename-object,--client-protocol=grpc"
        compatible:
              flat: true
              hns: true
              zonal: true
        run: "Benchmark_Rename"
        run_on_gke: true
      - flags:
          - "--stat-cache-ttl=0"
          - "--client-protocol=grpc,--stat-cache-ttl=0"
        compatible:
              flat: true
              hns: true
              zonal: true
        run: "Benchmark_Delete"
        run_on_gke: true

dentry_cache:
 - mounted_directory: "${MOUNTED_DIR}"
   test_bucket: "${BUCKET_NAME}"
   configs:
     - flags:
       - "--implicit-dirs,--experimental-enable-dentry-cache,--metadata-cache-ttl-secs=2"
       compatible:
         flat: true
         hns: true
         zonal: true
       run: TestStatWithDentryCacheEnabledTest
       run_on_gke: true
     - flags:
       - "--implicit-dirs,--experimental-enable-dentry-cache,--metadata-cache-ttl-secs=1000"
       compatible:
         flat: true
         hns: true
         zonal: true
       run: TestDeleteOperationTest
       run_on_gke: true
     - flags:
       - "--implicit-dirs,--experimental-enable-dentry-cache,--metadata-cache-ttl-secs=1000"
       compatible:
         flat: true
         hns: true
         zonal: true
       run: TestNotifierTest
       run_on_gke: true

read_gcs_algo:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
        # Do not enable fileCache as we want to test gcs read flow.
          - "--implicit-dirs"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

unfinalized_object:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
        - "--metadata-cache-ttl-secs=-1"
        - "--metadata-cache-ttl-secs=-1,--enable-kernel-reader=false"
        compatible:
          flat: false
          hns: false
          zonal: true
        run: TestUnfinalizedObjectReadTest
        run_on_gke: true
      - flags:
        - "--metadata-cache-ttl-secs=0"
        - "--metadata-cache-ttl-secs=0,--enable-kernel-reader=false"
        compatible:
          flat: false
          hns: false
          zonal: true
        run: TestUnfinalizedObjectOperationTest
        run_on_gke: true
      - flags:
        - "--metadata-cache-ttl-secs=2"
        - "--metadata-cache-ttl-secs=2,--enable-kernel-reader=false"
        compatible:
          flat: false
          hns: false
          zonal: true
        run: TestUnfinalizedObjectTailingReadTest
        run_on_gke: true

interrupt:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
        #TODO(b/417136852): Enable this test for Zonal Bucket also once read start working.
          - "--enable-streaming-writes"
        compatible:
          flat: true
          hns: true
          zonal: false
        run_on_gke: true
      - flags:
          - "--implicit-dirs,--enable-streaming-writes=false"
          - "--ignore-interrupts,--enable-streaming-writes=false"
          - "--ignore-interrupts=false,--enable-streaming-writes=false"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: true

log_rotation:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    log_file: # To be removed
    configs:
      - flags:
          - "--log-file=/gcsfuse-tmp/TestLogRotation.log,--log-rotate-max-file-size-mb=2,--log-rotate-backup-file-count=2,--log-rotate-compress=false,--log-severity=trace"
          - "--log-file=/gcsfuse-tmp/TestLogRotation.log,--log-rotate-max-file-size-mb=2,--log-rotate-backup-file-count=2,--log-rotate-compress,--log-severity=trace"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: false

flag_optimizations:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - run: TestMountFails
        flags:
          - "--profile=unknown-profile"
        compatible:
          flat: true
          hns: true
          zonal: true
        run_on_gke: false
      - run: TestImplicitDirsNotEnabled
        flags:
          - "--machine-type=low-end-machine"
        compatible:
          flat: true
          hns: false
          zonal: false
        run_on_gke: true
      - run: TestRenameDirLimitNotSet
        flags:
          - "--machine-type=low-end-machine"
          - "--profile=aiml-training"
          - "--profile=aiml-serving"
        compatible:
          flat: true
          hns: false
          zonal: false
        run_on_gke: true
      - run: TestImplicitDirsEnabled
        flags:
          - "--machine-type=a3-highgpu-8g"
          - "--profile=aiml-training"
          - "--profile=aiml-serving"
          - "--profile=aiml-checkpointing"
          - "--machine-type=low-end-machine,--profile=aiml-training"
          - "--machine-type=low-end-machine,--profile=aiml-serving"
          - "--machine-type=low-end-machine,--profile=aiml-checkpointing"
        compatible:
          flat: true
          hns: false
          zonal: false
        run_on_gke: true
      - run: TestRenameDirLimitSet
        flags:
          - "--machine-type=a3-highgpu-8g"
          - "--profile=aiml-checkpointing"
          - "--machine-type=low-end-machine,--profile=aiml-checkpointing"
        compatible:
          flat: true
          hns: false
          zonal: false
        run_on_gke: true

unsupported_path:
- mounted_directory: "${MOUNTED_DIR}"
  test_bucket: "${BUCKET_NAME}"
  only_dir: "${ONLY_DIR}"
  log_file: # Optional
  configs:
  - flags:
    - "--implicit-dirs,--client-protocol=grpc,--enable-unsupported-path-support,--rename-dir-limit=200,--metadata-cache-negative-ttl-secs=0"
    compatible:
      flat: true
      hns: true
      zonal: false
    run_on_gke: true
  - flags:
    - "--implicit-dirs,--enable-unsupported-path-support,--rename-dir-limit=200,--metadata-cache-negative-ttl-secs=0"
    compatible:
      flat: true
      hns: true
      zonal: true
    run_on_gke: true

kernel_list_cache:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
          - "--kernel-list-cache-ttl-secs=-1"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: "TestInfiniteKernelListCacheTest"
        run_on_gke: true
      - flags:
          # Note: metadata cache is disabled to avoid cache consistency issue between gcsfuse cache and kernel cache. As
          # gcsfuse cache might hold the entry which already became stale due to delete operation.
          - "--kernel-list-cache-ttl-secs=-1,--metadata-cache-ttl-secs=0,--metadata-cache-negative-ttl-secs=0"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: "TestInfiniteKernelListCacheDeleteDirTest"
        run_on_gke: true
      - flags:
          - "--kernel-list-cache-ttl-secs=5,--rename-dir-limit=10"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: "TestFiniteKernelListCacheTest"
        run_on_gke: true
      - flags:
          - "--kernel-list-cache-ttl-secs=0,--stat-cache-ttl=0,--rename-dir-limit=10"
        compatible:
          flat: true
          hns: true
          zonal: true
        run: "TestDisabledKernelListCacheTest"
        run_on_gke: true

rapid_appends:
  - mounted_directory: "${MOUNTED_DIR}"
    mounted_directory_secondary: "${MOUNTED_DIR_SECONDARY}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - run: TestSingleMountAppendsTestSuite
        flags:
          - "--write-block-size-mb=1"
        compatible:
          flat: false
          hns: false
          zonal: true
        run_on_gke: true
      - run: TestDualMountAppendsTestSuite
        flags:
          - "--write-block-size-mb=1"
        secondary_flags:
          - "--write-block-size-mb=1"
        compatible:
          flat: false
          hns: false
          zonal: true
        run_on_gke: true
      - run: TestSingleMountReadsTestSuite
        flags:
          - "--metadata-cache-ttl-secs=0" # NoCache
          - "--metadata-cache-ttl-secs=70" # MetadataCache
          - "--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache,--metadata-cache-ttl-secs=0" # FileCache
          - "--metadata-cache-ttl-secs=70,--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache" # MetadataAndFileCache
          - "--metadata-cache-ttl-secs=0,--enable-kernel-reader=false" # NoCacheWithoutKernelReader
          - "--metadata-cache-ttl-secs=70,--enable-kernel-reader=false" # MetadataCacheWithMRDWrapperWithoutKernelReader
          - "--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache,--metadata-cache-ttl-secs=0,--enable-kernel-reader=false" # FileCacheWithoutKernelReader
          - "--metadata-cache-ttl-secs=70,--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache,--enable-kernel-reader=false" # MetadataAndFileCacheWithoutKernelReader
        compatible:
          flat: false
          hns: false
          zonal: true
        run_on_gke: true
      - run: TestDualMountReadsTestSuiteWithMetadataCache
        flags:
          - "--metadata-cache-ttl-secs=70"
          - "--metadata-cache-ttl-secs=70,--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache-primary"
          - "--metadata-cache-ttl-secs=70,--enable-kernel-reader=false"
          - "--metadata-cache-ttl-secs=70,--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache-primary,--enable-kernel-reader=false"
        secondary_flags:
          - "--write-block-size-mb=1"
          - "--write-block-size-mb=1"
          - "--write-block-size-mb=1"
          - "--write-block-size-mb=1"
        compatible:
          flat: false
          hns: false
          zonal: true
        run_on_gke: true
      - run: TestDualMountReadsTestSuiteWithoutMetadataCache
        flags:
          - "--metadata-cache-ttl-secs=0"
          - "--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache-primary,--metadata-cache-ttl-secs=0"
          - "--metadata-cache-ttl-secs=0,--enable-kernel-reader=false"
          - "--file-cache-max-size-mb=-1,--cache-dir=/gcsfuse-tmp/cache-primary,--metadata-cache-ttl-secs=0,--enable-kernel-reader=false"
        secondary_flags:
          - "--write-block-size-mb=1"
          - "--write-block-size-mb=1"
          - "--write-block-size-mb=1"
          - "--write-block-size-mb=1"
        compatible:
          flat: false
          hns: false
          zonal: true
        run_on_gke: true

monitoring:
  - mounted_directory: "${MOUNTED_DIR}"
    test_bucket: "${BUCKET_NAME}"
    configs:
      - flags:
        - "--prometheus-port=9190,--cache-dir=/gcsfuse-tmp/PromOTELSuite,--log-file=/gcsfuse-tmp/monitoring.log,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: false
          zonal: false
        run: "TestPromOTELSuite"
        run_on_gke: true
      - flags:
        - "--prometheus-port=10190,--cache-dir=/gcsfuse-tmp/PromOTELSuite,--log-file=/gcsfuse-tmp/monitoring_hns.log,--enable-kernel-reader=false"
        compatible:
          flat: false
          hns: true
          zonal: true
        run: "TestPromOTELSuite"
        run_on_gke: true
      - flags:
        - "--prometheus-port=9191,--enable-buffered-read,--read-block-size-mb=4,--read-random-seek-threshold=2,--read-global-max-blocks=5,--read-min-blocks-per-handle=2,--read-start-blocks-per-handle=2,--log-file=/gcsfuse-tmp/prom_buffered_read.log,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: false
          zonal: false
        run: "TestPromBufferedReadSuite"
        run_on_gke: true
      - flags:
        - "--prometheus-port=10191,--enable-buffered-read,--read-block-size-mb=4,--read-random-seek-threshold=2,--read-global-max-blocks=5,--read-min-blocks-per-handle=2,--read-start-blocks-per-handle=2,--log-file=/gcsfuse-tmp/prom_buffered_read_hns.log,--enable-kernel-reader=false"
        compatible:
          flat: false
          hns: true
          zonal: true
        run: "TestPromBufferedReadSuite"
        run_on_gke: true
      - flags:
        - "--client-protocol=grpc,--experimental-enable-grpc-metrics,--prometheus-port=9192,--cache-dir=/gcsfuse-tmp/TestPromGrpcMetricsSuite,--log-file=/gcsfuse-tmp/prom_grpc_metrics.log,--enable-kernel-reader=false"
        compatible:
          flat: true
          hns: false
          zonal: false
        run: "TestPromGrpcMetricsSuite"
        run_on_gke: true
      - flags:
        - "--client-protocol=grpc,--experimental-enable-grpc-metrics,--prometheus-port=10192,--cache-dir=/gcsfuse-tmp/TestPromGrpcMetricsSuite,--log-file=/gcsfuse-tmp/prom_grpc_metrics_hns.log,--enable-kernel-reader=false"
        compatible:
          flat: false
          hns: true
          zonal: true
        run: "TestPromGrpcMetricsSuite"
        run_on_gke: true
      - flags:
        - "--prometheus-port=9193 --log-file=/gcsfuse-tmp/prom_kernel_reader.log"
        compatible:
          flat: false
          hns: false
          zonal: true
        run: "TestPromKernelReaderSuite"
        run_on_gke: false
